## HairSalon — система онлайн‑записи в парикмахерскую

Полноценное решение для онлайн‑записи к парикмахерам, состоящее из веб‑приложения (Vite + React + Firebase) и Telegram‑бота (Node.js + Telegraf + Firebase Admin). Проект позволяет клиентам записываться к специалистам, администратору — управлять расписанием, мастерам — видеть свои слоты и клиентов.

### Демо и примеры работы

- **Веб‑приложение (продакшен)**: [`https://hair-salon-lemon.vercel.app`](https://hair-salon-lemon.vercel.app)  
- **Telegram‑бот записи**: [`https://t.me/olgafedor_bot`](https://t.me/olgafedor_bot)  

В веб‑приложении пользователи авторизуются через Google, заполняют профиль (обязательно указывают телефон), выбирают парикмахера и свободный слот, а администратор управляет расписанием и пользователями через админ‑панель. Telegram‑бот использует те же данные в Firestore, поэтому записи и слоты синхронизированы.

---

## Технологический стек

### Веб‑приложение (`/`)

- **Язык**: TypeScript
- **Фреймворк**: React 18 (`react`, `react-dom`)
- **Сборщик / Dev‑сервер**: Vite (`vite`, `@vitejs/plugin-react`)
- **Маршрутизация**: `react-router-dom`
- **UI и стили**: Tailwind CSS (`tailwindcss`, `postcss`, `autoprefixer`)
- **Анимации**: `framer-motion`
- **Иконки**: `react-icons`
- **Backend‑as‑a‑Service**: Firebase client SDK (`firebase`)
  - Firebase Authentication (логин через Google)
  - Cloud Firestore (пользователи, парикмахеры, слоты, записи)
- **PWA**: `vite-plugin-pwa` (иконки и манифест для установки веб‑приложения)

### Telegram‑бот (`/telegram-bot`)

- **Язык**: TypeScript
- **Платформа**: Node.js 18+
- **Telegram‑фреймворк**: `telegraf`
- **Доступ к данным**: `firebase-admin` (работа с Firestore от имени сервисного аккаунта)
- **Конфигурация**: `dotenv`

---

## Структура репозитория

- `src/` — фронтенд (React + Vite)
  - `pages/` — основные страницы: главная (`Home`), админ‑панель (`Admin`), профиль пользователя (`ProfileUser`), профиль специалиста (`ProfileSpecialist`), аутентификация (`Login`, `Register`), 404‑страница.
  - `components/` — переиспользуемые компоненты: навбар, списки парикмахеров, сетка слотов, скелетоны загрузки, админские таблицы и т.п.
  - `context/AuthContext.tsx` — контекст аутентификации (Firebase Auth, роли пользователей).
  - `hooks/` — хуки для работы с Firestore (загрузка мастеров, слотов, записей, пользователей).
  - `services/firebase.ts` — инициализация Firebase (Auth + Firestore) через `import.meta.env`.
  - `utils/` — утилиты для дат, отпусков и выгрузки CSV.
- `telegram-bot/` — код телеграм‑бота
  - `src/bot.ts`, `src/handlers/*` — логика бота и обработчики команд/действий.
  - `src/services/*` — работа с Firestore (слоты, записи, пользователи, мастера).
  - `README.md`, `FIREBASE_SETUP.md`, `KOYEB_DEPLOY.md`, `DEPLOYMENT_OPTIONS.md` — документация по боту и деплою.

---

## Функциональность веб‑приложения

- **Авторизация и роли**
  - Вход через Google (Firebase Authentication).
  - В профиле пользователя обязательно указывается телефон (нормализуется к формату `8 9XX XXX-XX-XX`).
  - Роли: обычный пользователь (`user`) и администратор (`admin`). Роли хранятся в коллекции `users` Firestore и управляются через админ‑панель.

- **Главная страница (`Home`)**
  - Список парикмахеров с выбором текущего специалиста.
  - Сетка доступных слотов на ближайшие 14 дней.
  - Бронирование слота с подтверждением и записью в коллекцию `appointments`.
  - Автоматическая проверка телефона пользователя: при отсутствии/некорректности перенаправляет в профиль для заполнения.
  - Баннер с ссылкой на Telegram‑бота `@olgafedor_bot` для записи через мессенджер.

- **Профиль пользователя (`ProfileUser`)**
  - Редактирование имени, email и телефона (с валидацией формата).
  - Жёсткое требование иметь валидный телефон: пока он не указан, пользователь видит модальное окно и не может уйти со страницы.
  - Список записей:
    - «Будущие» и «Архив», сортировка по дате.
    - Отмена будущих записей (удаление из `appointments`).

- **Профиль специалиста (`ProfileSpecialist`)**
  - Для мастеров: отображение их слотов (`slots`) и записей (`appointments`).
  - Ручное добавление/удаление слотов (дата + время).

- **Админ‑панель (`Admin`)**
  - **Вкладка «Записи»**: просмотр всех записей, отмена, экспорт в CSV.
  - **Вкладка «Рабочие часы»**:
    - Генерация слотов по диапазону дат, с интервалом (например, каждые 30 минут) и по выбранным дням недели.
    - Учёт отпусков мастера: слоты не создаются в период отпуска.
    - Просмотр и массовое удаление слотов для выбранного мастера.
  - **Вкладка «Пользователи»**:
    - Добавление и редактирование специалистов (имя, адрес, фото).
    - Удаление специалиста с одновременным удалением его слотов.
    - Список пользователей с поиском и сменой роли (`user` / `admin`).
    - Редактирование профиля пользователя (имя, телефон, адрес).

---

## Установка и запуск веб‑приложения

### 1. Предварительные требования

- Установленный **Node.js** (рекомендуется LTS, 18+).
- Аккаунт **Firebase** и созданный проект с:
  - Включенным **Authentication** (Google provider).
  - Настроенным **Cloud Firestore** в режиме production или test.

### 2. Клонирование репозитория

```bash
git clone <URL_ВАШЕГО_РЕПОЗИТОРИЯ>
cd HairSalon
```

### 3. Установка зависимостей (фронтенд)

В корне проекта (`HairSalon`):

```bash
npm install
```

> При желании можно использовать `yarn` или `pnpm`, но в репозитории уже есть `yarn.lock`, так что логично придерживаться той же системы пакетов.

### 4. Настройка переменных окружения для фронтенда

Создайте файл `.env` в корне проекта и заполните его значениями из настроек Firebase (Web app):

```bash
VITE_API_KEY=...
VITE_AUTH_DOMAIN=...
VITE_PROJECT_ID=...
VITE_STORAGE_BUCKET=...
VITE_MESSAGING_SENDER_ID=...
VITE_APP_ID=...
```

Эти значения соответствуют объекту `firebaseConfig`, который используется в `src/services/firebase.ts`.

### 5. Запуск в режиме разработки

```bash
npm run dev
```

По умолчанию Vite стартует на `http://localhost:3000` и автоматически откроет браузер.

### 6. Сборка production‑версии

```bash
npm run build
```

Собранные статические файлы будут лежать в директории `dist/`. Их можно деплоить на любой static‑hosting (Vercel, Netlify, Firebase Hosting и т.д.). Текущий продакшен‑домен: [`https://hair-salon-lemon.vercel.app`](https://hair-salon-lemon.vercel.app).

---

## Установка и запуск Telegram‑бота

Telegram‑бот вынесен в подпроект `telegram-bot/` и имеет собственный `package.json` и `README.md`.

### 1. Переход в директорию бота и установка зависимостей

```bash
cd telegram-bot
npm install
```

### 2. Настройка `.env`

Ориентируйтесь на `telegram-bot/README.md` и `.env.example` (если есть). Основные переменные:

- `TELEGRAM_BOT_TOKEN` — токен бота от `@BotFather`
- `FIREBASE_PROJECT_ID` — ID проекта Firebase
- `FIREBASE_PRIVATE_KEY` — приватный ключ сервисного аккаунта (строка с `\n`)
- `FIREBASE_CLIENT_EMAIL` — email сервисного аккаунта

Подробные шаги по получению этих данных описаны в [`telegram-bot/README.md`](telegram-bot/README.md) и [`FIREBASE_SETUP.md`](telegram-bot/FIREBASE_SETUP.md).

### 3. Локальный запуск бота

```bash
npm run dev
```

Бот начнёт обрабатывать сообщения в Telegram. Убедитесь, что:

- Токен бота корректен.
- Firebase‑учётные данные выданы сервисному аккаунту с доступом к Firestore.
- Firestore‑структура (`users`, `appointments`, `slots`, `hairdressers`) согласована с фронтендом.

### 4. Сборка и запуск в production

```bash
npm run build
npm start
```

Для деплоя на Koyeb, Railway, Render или другие платформы используйте инструкции:

- [`KOYEB_DEPLOY.md`](telegram-bot/KOYEB_DEPLOY.md)
- [`DEPLOYMENT_OPTIONS.md`](telegram-bot/DEPLOYMENT_OPTIONS.md)

Рекомендуем Koyeb: бесплатный тариф, контейнер не засыпает, нет требования привязывать карту.

---

## Как связаны веб‑приложение и Telegram‑бот

- Оба сервиса используют **один и тот же Firebase‑проект** и **одну и ту же Firestore‑базу**.
- Коллекции:
  - `users` — профиль пользователя, включая телефон и роль.
  - `hairdressers` — специалисты (имя, адрес, фото, отпуск).
  - `slots` — временные слоты (дата, время, специалист, статус `booked`).
  - `appointments` — записи клиентов к специалистам.
- Веб‑приложение:
  - Позволяет пользователю заполнять профиль и записываться.
  - Администратору — управлять расписанием, ролями, мастерами и экспортом данных.
- Telegram‑бот:
  - Работает как «тонкий клиент» к тем же данным: пользователь может записаться/просмотреть/отменить записи прямо из Telegram.

Важно: чтобы всё корректно работало, структура коллекций и правила безопасности Firestore должны быть настроены единообразно (см. `FIREBASE_SETUP.md` в папке бота и конфигурацию безопасности вашего Firebase проекта).

---

## Для кого этот проект

- **Владельцы салонов** — готовое облачное решение для онлайн‑записи без собственного backend‑сервера.
- **Разработчики** — пример связки Vite + React + Firebase + Telegram‑бот с общей базой данных.
- **Администраторы/менеджеры** — удобная админ‑панель для управления пользователями, мастерами и расписанием.

Код организован с учётом читаемости: разделение по страницам, компонентам, хукам и сервисам, использование современных подходов React и практик работы с Firebase.


